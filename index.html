<!DOCTYPE html>
<html>
	<head>
		<title>Capture Photo</title>

		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.css">
		<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.js"></script>
		<link rel="stylesheet" href="css/index-index.css" />
		<script type="text/javascript" charset="utf-8">
			var videoElement = document.querySelector("video");
			var audioSelect = document.querySelector("select#audioSource");
			var videoSelect = document.querySelector("select#videoSource");
			var startButton = document.querySelector("button#start");

			navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;

			function gotSources(sourceInfos) {
				for (var i = 0; i != sourceInfos.length; ++i) {
					var sourceInfo = sourceInfos[i];
					var option = document.createElement("option");
					option.value = sourceInfo.id;
					if (sourceInfo.kind === 'audio') {
						option.text = sourceInfo.label || 'microphone ' + (audioSelect.length + 1);
						audioSelect.appendChild(option);
					} else if (sourceInfo.kind === 'video') {
						option.text = sourceInfo.label || 'camera ' + (videoSelect.length + 1);
						videoSelect.appendChild(option);
					} else {
						console.log('Some other kind of source: ', sourceInfo);
					}
				}
			}

			if ( typeof MediaStreamTrack === 'undefined') {
				alert('This browser does not support MediaStreamTrack.\n\nTry Chrome Canary.');
			} else {
				MediaStreamTrack.getSources(gotSources);
			}

			function successCallback(stream) {
				window.stream = stream;
				// make stream available to console
				videoElement.src = window.URL.createObjectURL(stream);
				videoElement.play();
			}

			function errorCallback(error) {
				console.log("navigator.getUserMedia error: ", error);
			}

			function start() {
				if (!!window.stream) {
					videoElement.src = null;
					window.stream.stop();
				}
				var audioSource = audioSelect.value;
				var videoSource = videoSelect.value;
				var constraints = {
					audio : {
						optional : [{
							sourceId : audioSource
						}]
					},
					video : {
						optional : [{
							sourceId : videoSource
						}]
					}
				};
				navigator.getUserMedia(constraints, successCallback, errorCallback);
			}


			audioSelect.onchange = start;
			videoSelect.onchange = start;

			start();

		</script>
	</head>
	<body>
		<video id="Video" autoplay="autoplay" audio="muted" width="100%" height ="100%"> </video>

<script type="text/javascript">
if (navigator.getUserMedia) {
    var video = document.getElementById('Video');
    video.src = null;
    navigator.getUserMedia('video', successCallback, errorCallback);
    //if everything if good then set the source of the video element to the mediastream
    function successCallback(stream) {
        video.src = stream;
    }
    //If everything isn't ok then say so
    function errorCallback(error) {
        alert("An error occurred: [CODE " + error.code + "]");
    }
}
else {
    //show no support for getUserMedia
    alert("Native camera is not supported in this browser!");
}
</script>
		
	</body>
</html>

